import type { InfiltrationSolverFunction } from "$src/exploits/infiltration/solvers/keyCodes";
import { KeyCodes } from "$src/exploits/infiltration/solvers/keyCodes";
import { asyncWait } from "$server/utils/asyncUtils";
import type { InfiltrationMocks } from "$src/exploits/infiltration/InfiltrationMocks";

export const cheatCode: InfiltrationSolverFunction = async (
  mocks: InfiltrationMocks,
  infiltrationBody: HTMLElement,
) => {
  while (infiltrationBody.isConnected) {
    const code = infiltrationBody.querySelector("h4:nth-child(2)");

    switch (code?.textContent?.trim()) {
      case "↑":
        await mocks.enterKey(KeyCodes.UP_ARROW);
        break;
      case "↓":
        await mocks.enterKey(KeyCodes.DOWN_ARROW);
        break;
      case "←":
        await mocks.enterKey(KeyCodes.LEFT_ARROW);
        break;
      case "→":
        await mocks.enterKey(KeyCodes.RIGHT_ARROW);
        break;
      default:
        await asyncWait(500);
        break;
    }
  }
};
