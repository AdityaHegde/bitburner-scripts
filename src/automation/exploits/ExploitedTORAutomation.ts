import { TORAutomation } from "$src/automation/TORAutomation";
import { clickNav, exitModal, gotoLocation } from "$src/automation/exploits/goto";
import { asyncWait } from "$server/utils/asyncUtils";
import { runTerminalCommand } from "$src/automation/exploits/terminal";
import { doc } from "$src/automation/exploits/references";
import { closeFocusedWork, focusWork } from "$src/automation/exploits/work";

export class ExploitedTORAutomation extends TORAutomation {
  public async buyCrack(name: string): Promise<void> {
    await closeFocusedWork();

    await clickNav("Terminal");
    await asyncWait(500);
    runTerminalCommand(`buy ${name}`);

    return focusWork();
  }

  public async buyTorServer(): Promise<void> {
    await closeFocusedWork();

    await gotoLocation("T", 1);
    const buyTorButton = doc
      .evaluate(`//button[contains(., "TOR")]`, doc)
      .iterateNext() as HTMLElement;
    buyTorButton.click();
    await asyncWait(500);
    exitModal();
    await asyncWait(500);
    await clickNav("Terminal");

    return focusWork();
  }
}
