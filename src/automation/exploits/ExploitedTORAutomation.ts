import { TORAutomation } from "$src/automation/TORAutomation";
import { clickNav, exitModal, gotoLocation } from "$src/automation/exploits/goto";
import { asyncWait } from "$server/utils/asyncUtils";
import { runTerminalCommand } from "$src/automation/exploits/terminal";
import { doc } from "$src/automation/exploits/references";

export class ExploitedTORAutomation extends TORAutomation {
  public async buyCrack(name: string): Promise<void> {
    await clickNav("Terminal");
    await asyncWait(500);
    runTerminalCommand(`buy ${name}`);
  }

  public async buyTorServer(): Promise<void> {
    await gotoLocation("T", 1);
    const buyTorButton = doc
      .evaluate(`//button[contains(., "TOR")]`, doc)
      .iterateNext() as HTMLElement;
    buyTorButton.click();
    await asyncWait(500);
    exitModal();
    await asyncWait(500);
    return clickNav("Terminal");
  }
}
